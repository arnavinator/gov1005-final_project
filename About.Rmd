---
title: "Global Health Expenditure by Demographics"
author: "Arnav Srivastava"
date: "2/28/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)

library(tidyverse)
```
## Milestone 4 update
Currently, I have been working on cleaning up and finalizing the data I want to use for my project. I have decided that I will probably cut one dataset on child healthcare from my gather_data, as it does not have information for most western countries; unless I change my project to analyzing health in Africa, this dataset cannot help with many findings.
I have cleaned up my datasets, and have merged two datasets so that I can know the WHO reigion and WB income bracket of each country. I then merged this dataset with my cleaned up population demographics dataset. Finally, I merged this dataset with my
My next steps will be to pivot this table, and figure out a way to inner_join the year column of pop_demo with the year column of health_expend dataset, as currently my table is unable to merge these comprehensively. 

```{r testing, echo = FALSE}


# loading libraries to read and process datasets, and cleaned names of every
# dataset

library(tidyverse)
library(readr)
library(readxl)
library(rvest)
library(janitor)

# tells which income group each country is in. Selected columns economy and
# income_group, as other columns were irrelevant. Then, removed the first row as
# it was kept null, and last few rows as information was not relevant to country
# income. Finally, I manually renamed many contries so that they would properly
# join with the classification dataset due to inconsistent naming between both
# datasets
  
income <- read_excel("raw-data/Income class of countries.xls", skip = 4) %>% 
  clean_names() %>% 
  select(economy, income_group)
income <- income[-c(1),]
income <- income[-c(219:274),]

income <- income %>% 
  mutate(economy = str_replace(economy, "Antigua and Barbuda", "Antigua And Barbuda"),
         economy = str_replace(economy, "Bahamas, The", "Bahamas"),
         economy = str_replace(economy, "Congo, Dem. Rep.", "Democratic Republic of the Congo"),
         economy = str_replace(economy, "Egypt, Arab Rep.", "Egypt"),
         economy = str_replace(economy, "Gambia, The", "Gambia"),
         economy = str_replace(economy, "Iran, Islamic Rep.", "Iran, Islamic Republic of"),
         economy = str_replace(economy, "Korea, Dem. People's Rep.", "Democratic Peoples Republic of Korea"),
         economy = str_replace(economy, "Korea, Rep.", "Korea, Republic of"),
         economy = str_replace(economy, "Kyrgyz Republic", "Kyrgyzstan"),
         economy = str_replace(economy, "Moldova", "Moldova, Republic of"),
         economy = str_replace(economy, "St. Kitts and Nevis", "Saint Kitts"),
         economy = str_replace(economy, "St. Lucia", "Saint Lucia"),
         economy = str_replace(economy, "St. Vincent and the Grenadines", "Saint Vincent and the Grenadines"),
         economy = str_replace(economy, "São Tomé and Principe", "Sao Tome And Principe"),
         economy = str_replace(economy, "Tanzania", "Tanzania, United Republic of"),
         economy = str_replace(economy, "Slovak Republic", "Slovakia"),
         economy = str_replace(economy, "United States", "United States of America"),
         economy = str_replace(economy, "Venezuela, RB", "Venezuela"),
         economy = str_replace(economy, "Vietnam", "Viet Nam"),
         economy = str_replace(economy, "Yemen, Rep.", "Yemen"),
         economy = str_replace(economy, "Micronesia, Fed. Sts.", "Micronesia, Federated States of"),
         economy = str_replace(economy, "Congo, Rep.", "Congo")
  )


# pulls table from internet which classifies countries by their reigion...
# needed to skip the first line, and filter out all rows where countries were
# not listed (the table had rows to index all countries starting by the same
# letter). Selected for only country name and reigion, all else was irrelevant

page <- read_html("https://www.who.int/choice/demography/by_country/en/")
country_reigion <- html_nodes(page, "table") %>% .[[1]] %>%
  html_table(fill = TRUE) %>% 
  clean_names() %>% 
  mutate(country = x1,
         reigion_num = x2,
         reigion = x3) %>% 
  select(country, reigion) %>% 
  filter(reigion != "")
country_reigion <- country_reigion[-c(1),]



# merges dataset identifying a country's WHO reigion and their WB Income
# Bracket... classification now has info from both!

classification <- country_reigion %>% 
  inner_join(income, by = c("country" = "economy"))


# uploads health expenditure dataset, which gives Current Health Expenditure
# (CHE) per Capita in US$, Domestic General Government Health Expenditure
# (GGHE-D) as % Gross Domestic Product (GDP), and Gross Domestic Product for all
# countries from 2000-2017. In order to merge this with classifcation, we need
# to once again manually change names to match for joining, remove useless
# column "x3", and also remove the first row  of the df after the titles since
# it just cluttered the table. 

health_expend <- read_excel("raw-data/health expend and gdp.xlsx") %>% 
  clean_names() %>%
  mutate(countries = str_replace(countries, "Antigua and Barbuda", "Antigua And Barbuda"),
         countries = str_replace(countries, "Bolivia Plurinational States of", "Bolivia "),
         countries = str_replace(countries, "Iran", "Iran, Islamic Republic of"),
         countries = str_replace(countries, "Republic of Korea", "Korea, Republic of"),
         countries = str_replace(countries, "Micronesia (Federated States of)", "Micronesia, Federated States of"),
         countries = str_replace(countries, "Republic of Moldova", "Moldova, Republic of"),
         countries = str_replace(countries, "Sao Tome and Principe", "Sao Tome And Principe"),
         countries = str_replace(countries, "Syria", "Syrian Arab Republic"),
         countries = str_replace(countries, " (Bolivarian Republic of)", "")
  ) %>% 
  select(-x3)

health_expend <- health_expend[-c(1),]

# Next, I pivotted_longer the table so that data is more readable, while
# converting all columns with gdp/spending numbers to numeric (they were
# character before) in order to process for data sorting. I then filtered the
# "x" from all years (ex "x2017"), and turned years into numeric as well to
# process for data sorting. I then pivot_wider the indicators so that they were
# easier to read, ultimately allowing us to see spending relationships over
# time. Finally, I removed the indicator "gov expenditure on infectious disease"
# as it barely had any data

health_expend <- health_expend %>% 
  pivot_longer(c("x2000", "x2001", "x2002", "x2003", "x2004", "x2005", "x2006", "x2007", "x2008", "x2009", "x2010", "x2011", "x2012", "x2013", "x2014", "x2015", "x2016", "x2017"), 
               names_to = "year", 
               values_to = "value",
               values_drop_na = TRUE
               ) %>% 
  mutate(value = as.numeric(value)) %>% 
  mutate(year = str_replace(year, "x", "")) %>% 
  mutate(year = as.numeric(year)) %>% 
  pivot_wider(names_from = indicators, values_from = value) %>% 
  select(-"Domestic General Government Expenditure on Infectious and Parasitic diseases")


# created combined country classification and healthcare expenditure dataset

classified_expend <- classification %>% 
  inner_join(health_expend, by = c("country" = "countries")) %>% 
  clean_names()


# create plot which tracks CHE per reigion over time, use options(scipen) to
# make sure y-scale is not in ugly standard notation

options(scipen=10000)
classified_expend %>% 
  group_by(reigion, year) %>%
  filter(!is.na(current_health_expenditure_che_per_capita_in_us)) %>% 
  summarize(sum = sum(current_health_expenditure_che_per_capita_in_us)) %>% 
  ggplot(aes(x = year, y = sum, color = reigion)) +
  geom_line() +
  theme_classic() +
  labs(title = "Current Health Expenditure over Time by WHO Region",
       x = "Year",
       y = "Total Expenditure per Year in Current USD",
       color = "WHO Reigion")


# create plot which tracks CHE per income over time

classified_expend %>% 
  group_by(income_group, year) %>%
  filter(!is.na(current_health_expenditure_che_per_capita_in_us)) %>% 
  summarize(sum = sum(current_health_expenditure_che_per_capita_in_us)) %>% 
  ggplot(aes(x = year, y = sum, color = income_group)) +
  geom_line() + 
  theme_classic() +
  labs(title = "Current Health Expenditure over Time by WB Income Group",
       x = "Year",
       y = "Total Expenditure per Year in Current USD",
       color = "Income Group")
  
  
```


## Background

For this project, I strive to analyze how global health expenditure varies based on economic and geographic factors. From the World Bank (WB), the Global Data Health Exchange, and the World Health Organization (WHO), I have gathered data regarding population sex/age demographics; the estimated the burden of diseases, injuries, and risk factors; historic health care spending and health care spending projections (1995-2050); current health expenditure per capita and per general government expenditure; and domestic/foreign expenditure for healthcare for children under 5; for 195 countries from 2000-2018. I plan on grouping countries by WB Income brackets and WHO Reigional Brackets to explore how the collected variables effect the proportional spending on health through an income and reigional lens.

For instance, I hope to answer questions such as: what gender and age demographics maximize spending on healthcare children per capita? With what demographics and income bracket leads countries to maximize spending on infectious diseases (which socioeconomic conditions maximize the the balance between spending on healthcare per capita with respect incidence/impact to infectious disease in the area?)


This data can be found on my GitHub repo at https://github.com/arnavinator/gov1005-final_project

## About Me
My name is Arnav Srivastava, and I am currently a first-year at Harvard College. I am fascinated by global health and improving accessibility to the ever-growing frontier of science; I hope to concentrate in biomedical engineering, electrical engineering, or statistics, and help advance the health of our global community.



